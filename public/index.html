<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="user-scalable=no, initial-scale=1.0, width=device-width" />
		<title>재정(코인원, 업비트, 비트렉스, 비스탬프)</title>
		<link rel="stylesheet" href="/bootstrap.min.css">
		<script type="text/javascript" src="/socket.io.slim.js"></script>
		<script type="text/javascript" src="/sockjs.min.js"></script>
		<script type="text/javascript" src="/pusher.min.js"></script>
		<style>
			.coinone_standard {
				color: #FF7F00;
				font-weight: bold;
			}
			.upbit_standard {
				color: #0080FF;
				font-weight: bold;
			}
			.ask_color {
				background-color : #e7f5ff;
				/* color: #1258C2; */
			}
			.bid_color {
				background-color: #fff2f6;
				/* color: #E60909; */
			}
			.plus_color4 {
				color: green;
				font-weight: bold;
				text-decoration: underline;
			}
			.plus_color3 {
				color: green;
				font-weight: bold;
				text-decoration: underline;
			}
			.plus_color2 {
				color: green;
				font-weight: bold;
			}
			.plus_color1 {
				color: green;
			}
			.minus_color1 {
				color: red;
			}
			.minus_color2 {
				color: red;
				font-weight: bold;
			}
			.minus_color3 {
				color: red;
				font-weight: bold;
				text-decoration: underline;
			}
			.minus_color4 {
				color: red;
				font-weight: bold;
				text-decoration: underline;
			}
			@media only screen and (max-width : 670px) {
				body {
					font-size: 9px;
				}
			}
			td {
				text-align: right;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<p>
				[BTC 기준가격] <span class="coinone_standard">Coinone : <span id="btc-standard"></span></span> <span class="upbit_standard">Upbit : <span id="btc-standard-upbit"></span></span>
			</p>
			<div id="exchange-table">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th class="col-md-1">코인</th>
							<th class="col-md-1">코인원</th>
							<th class="col-md-2 coinone_standard">업비트</th>
							<th class="col-md-2 upbit_standard">업비트<br class="visiable-xs">(BTC원)</th>
							<th class="col-md-2 coinone_standard">비렉<br class="visiable-xs">(BTC원)</th>
							<th class="col-md-1">비렉(BTC)</th>
							<th class="col-md-2 coinone_standard">빗탬<br class="visiable-xs">(BTC원)</th>
							<th class="cod-md-1">빗탬(BTC)</th>
						</tr>
					</thead>
					<tbody>
						<tr is=exchange-line
						v-for="item in lines"
						v-bind:line='item'
						v-bind:key='item.id'
						v-bind:class='{ ask_color: item.ask, bid_color: item.bid}'>
					</tr>
					</tbody>
				</table>
			</div>

			<div class="container_fluids">
				<div class="row">
					<div class="col-xs-12 col-md-2">
					<label>원화 <input id="input-won" type="number" value=11000000 min=0></label>
					</div>
					<div class="col-xs-12 col-md-2">
					<label>달러 <input id="input-dollar" type="number" value=10000 min=0></label>
					</div>
					<div class="col-xs-12 col-md-2">
					<label>환율 <input id="input-exchange-rate" type="text" value=1100 readonly></label>
					</div>
				</div>
			</div>
			
			<table class="table table-bordered">
				<thead>
					<tr>
						<th class="text-center">종류</th>
						<th class="text-center">빗탬(달러)</th>
						<th class="text-center">빗탬(원)</th>
						<th class="text-center">코인원(원)</th>
						<th class="text-center">이익</th>
					</tr>
				</thead>
				<tbody>
					<!-- <tr>
						<td class="text-center">BTC</td>
						<td class="text-right" id="btc-dollar"></td>
						<td class="text-right" id="btc-dollar-won"></td>
						<td class="text-right" id="btc-won"></td>
						<td class="text-right" id="btc-profit"></td>
					</tr> -->
					<tr>
						<td class="text-center">BCH</td>
						<td class="text-right" id="bch-dollar"></td>
						<td class="text-right" id="bch-dollar-won"></td>
						<td class="text-right" id="bch-won"></td>
						<td class="text-right" id="bch-profit"></td>
					</tr>
					<tr>
						<td class="text-center">XRP</td>
						<td class="text-right" id="xrp-dollar"></td>
						<td class="text-right" id="xrp-dollar-won"></td>
						<td class="text-right" id="xrp-won"></td>
						<td class="text-right" id="xrp-profit"></td>
					</tr>
					<tr>
						<td class="text-center">LTC</td>
						<td class="text-right" id="ltc-dollar"></td>
						<td class="text-right" id="ltc-dollar-won"></td>
						<td class="text-right" id="ltc-won"></td>
						<td class="text-right" id="ltc-profit"></td>
					</tr>
				</tbody>
			</table>
		</div>
		<script type="text/javascript" src="/Scripts/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="/Scripts/jquery.signalr2.2.2.min.js"></script>
		<!-- <script type="text/javascript" src="/signalr/hubs"></script> -->
		<script type="text/javascript" src="/bootstrap.min.js"></script>
		<script type="text/javascript" src="/localStoragePolyfill.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<script>
			// Vue.js
			Vue.component('exchange-line', {
				props: ['line'],
				template : `<tr>
											<td>{{ line.coinName }}</td>
											<td>{{ line.coinone }}</td>
											<td>
												<span>{{ line.upbit }}</span>
												<br v-if="line.bid">
												<span>{{ line.upbitDiff }}</span>
												<br v-if="line.bid">
												<span>{{ line.uptbitPer }}</span>
											</td>
											<td>
												<span>{{ line.upbitKrw }}</span>
												<br v-if="line.bid">
												<span>{{ line.upbitKrwDiff }}</span>
												<br v-if="line.bid">
												<span>{{ line.upbitKrwPer }}</span>
											</td>
											<td>
												<span>{{ line.bittrexKrw }}</span>
												<br v-if="line.bid">
												<span>{{ line.bittrexDiff }}</span>
												<br v-if="line.bid">
												<span v-bind:class="{minus_color1:(line.bittrexPer < 0)}">{{ line.bittrexPer }}</span>
											</td>
											<td>{{ line.bittrex }}</td>
											<td>
												<span>{{ line.bitstampKrw }}</span>
												<br v-if="line.bid">
												<span>{{ line.bitstampDiff }}</span>
												<br v-if="line.bid">
												<span v-bind:class="{minus_color1:(line.bistampPer < 0)}">{{ line.bitstampPer }}</span>
											</td>
											<td>{{ line.bitstamp}} </td>
										</tr>`
			});

			var exchangeTable = new Vue({
				el: '#exchange-table',
				data: {
					lines: [
						{id: 0, coinName: 'BTC', ask: true, bid: false, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 1, coinName: 'BTC', ask: false, bid: true, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 2, coinName: 'BCC', ask: true, bid: false, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 3, coinName: 'BCC', ask: false, bid: true, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 4, coinName: 'XRP', ask: true, bid: false, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 5, coinName: 'XRP', ask: false, bid: true, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 6, coinName: 'LTC', ask: true, bid: false, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 7, coinName: 'LTC', ask: false, bid: true, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 8, coinName: 'ETH', ask: true, bid: false, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
						{id: 9, coinName: 'ETH', ask: false, bid: true, coinone:null, upbit:null, upbitDiff:null, upbitPer:null, upbitKrw:null, upbitKrwDiff:null, upbitKrwPer:null, bittrex:null, bittrexKrw:null, bittrexDiff: null, bittrexPer: null, bitstamp:null, bitstampKrw:null, bitstampDiff:null, bitstampPer:null},
					]
				}
			});
			
			// Bitstamp dollar exchange table
			const input_dollar = document.getElementById("input-dollar");
			const input_won = document.getElementById("input-won");
			const input_exchange_rate = document.getElementById("input-exchange-rate");
			let dollar = 10000;
			let won = 11000000;
			let exchangeRate = 1100;

			// LocalStorage
			if (localStorage.getItem("dollar")) {
				dollar = localStorage.getItem("dollar");
				input_dollar.value = dollar;
			} 
			if (localStorage.getItem("won")) {
				won = localStorage.getItem("won");
				input_won.value = won;
			}
			if (localStorage.getItem("exchangeRate")) {
				exchangeRate = localStorage.getItem("exchangeRate");
				input_exchange_rate.value = exchangeRate;
			}

			input_dollar.addEventListener("change", function(event) {
				dollar = event.target.value
				exchangeRate = (won / dollar).toFixed(2); 
				input_exchange_rate.value = exchangeRate;
				localStorage.setItem("dollar", dollar);
				localStorage.setItem("exchangeRate", exchangeRate);
			});

			input_won.addEventListener("change", function(event) {
				won = event.target.value
				exchangeRate = (won / dollar).toFixed(2); 
				input_exchange_rate.value = exchangeRate;
				localStorage.setItem("won", won);
				localStorage.setItem("exchangeRate", exchangeRate);
			});

			function updateDollarExchange(coin, price) {
				const dw = parseInt(price * exchangeRate);
				const cw = data["coinone_"+coin+"_bid"];
				const diff = cw - dw;
				const percentage = (diff / dw * 100).toFixed(2);
				document.getElementById(coin+"-dollar").innerHTML = price.toLocaleString();
				document.getElementById(coin+"-dollar-won").innerHTML = dw.toLocaleString();
				document.getElementById(coin+"-won").innerHTML = cw.toLocaleString();
				document.getElementById(coin+"-profit").innerHTML = diff.toLocaleString() + "(" + percentage.toString() + "%)";
			}
			
			// Object contains all data
			let audio_flag = true;
			let data = {
				coinone_btc_ask : null,
				coinone_btc_bid : null,
				coinone_bch_ask : null,
				coinone_bch_bid : null,
				coinone_xrp_ask : null,
				coinone_xrp_bid : null,
				coinone_ltc_ask : null,
				coinone_ltc_bid : null,
				coinone_eth_ask : null,
				coinone_eth_bid : null,
			}

			// Upbit Websocket Part
			const sock = new SockJS("https://crix-websocket.upbit.com/sockjs");
			let upbitBTC = 1;
			const upbitKrwTradeFee = 0.0005;
			const upbitBtcTradeFee = 0.0025;
			const displayBtcStandardUpbit = document.getElementById("btc-standard-upbit");
			const krwList = [
											"CRIX.UPBIT.KRW-BTC",
			    					 		"CRIX.UPBIT.KRW-BCC", 
			    					 		"CRIX.UPBIT.KRW-XRP",
			    					 		"CRIX.UPBIT.KRW-LTC",
			    					 		"CRIX.UPBIT.KRW-ETH"
							];
			const btcList = [
			    					 		"CRIX.UPBIT.BTC-BCC", 
			    					 		"CRIX.UPBIT.BTC-XRP",
			    					 		"CRIX.UPBIT.BTC-LTC",
			    					 		"CRIX.UPBIT.BTC-ETH"
			                ];

			const coins = { btc:0, bch:2, xrp:4, ltc:6, eth:8 };

			sock.onopen = function() {
				console.log('open');
				sock.send(JSON.stringify([
					{	type: "crixOrderbook", 
						codes: krwList.concat(btcList)
					},
					{ ticket: "ram macbook" }
				]));
			};

		 	sock.onmessage = function(e) {
				const upbit = JSON.parse(e.data);
				const type = upbit.code.split("-")[1].toLowerCase();
				let coin_idx = upbit.code.split("-")[1].toLowerCase();
				if (coin_idx == 'bcc') {
					coin_idx = 'bch';
				}
				const ask_idx = coins[coin_idx];
				const bid_idx = coins[coin_idx] + 1;
				
				if(btcList.indexOf(upbit.code) >= 0) {
					exchangeTable.lines[ask_idx]["bittrex"] = upbit.orderbookUnits[0].askPrice.toFixed(8).toString();
					exchangeTable.lines[bid_idx]["bittrex"] = upbit.orderbookUnits[0].bidPrice.toFixed(8).toString();
					
					if (exchangeTable.lines[1]["coinone"].replace(/,/g,"") && exchangeTable.lines[1]["upbit"].replace(/,/g,"") && exchangeTable.lines[ask_idx]["coinone"].replace(/,/g,"")) {
						const coinone_coin_ask = parseInt(exchangeTable.lines[ask_idx]["coinone"].replace(/,/g,""));
						const coinone_btc_bid = parseInt(exchangeTable.lines[1]["coinone"].replace(/,/g,""));
						const upbit_btc_bid = parseInt(exchangeTable.lines[1]["upbit"].replace(/,/g,""));
						const upbit_krw_bid = parseInt(upbit.orderbookUnits[0].bidPrice*upbit_btc_bid);
						const bittrex_krw_bid = parseInt(upbit.orderbookUnits[0].bidPrice*coinone_btc_bid);
						const upbit_krw_diff = bittrex_krw_bid - coinone_coin_ask;
						const bittrex_krw_diff = upbit_krw_bid - coinone_coin_ask;
						exchangeTable.lines[ask_idx]["bittrexKrw"] = parseInt(upbit.orderbookUnits[0].askPrice*coinone_btc_bid).toLocaleString();
						exchangeTable.lines[bid_idx]["bittrexKrw"] = parseInt(bittrex_krw_bid).toLocaleString();
						exchangeTable.lines[bid_idx]["bittrexDiff"] = (upbit_krw_diff).toLocaleString();
						exchangeTable.lines[bid_idx]["bittrexPer"] = (upbit_krw_diff / coinone_coin_ask * 100).toFixed(2).toString();
						exchangeTable.lines[ask_idx]["upbitKrw"] = parseInt(upbit.orderbookUnits[0].askPrice*upbit_btc_bid).toLocaleString();
						exchangeTable.lines[bid_idx]["upbitKrw"] = parseInt(upbit_krw_bid).toLocaleString();
						exchangeTable.lines[bid_idx]["upbitKrwDiff"] = (bittrex_krw_diff).toLocaleString();
						exchangeTable.lines[bid_idx]["upbitKrwPer"] = (bittrex_krw_diff / coinone_coin_ask * 100).toFixed(2).toString();
					}
				} else if(krwList.indexOf(upbit.code) >= 0) {
					exchangeTable.lines[ask_idx]["upbit"] = upbit.orderbookUnits[0].askPrice.toLocaleString();
					exchangeTable.lines[bid_idx]["upbit"] = upbit.orderbookUnits[0].bidPrice.toLocaleString();
					
					if (exchangeTable.lines[ask_idx]["coinone"].replace(/,/g,"")) {
						const coinone_coin_ask = parseInt(exchangeTable.lines[ask_idx]["coinone"].replace(/,/g,""));
						const upbit_per = upbit.orderbookUnits[0].bidPrice - coinone_coin_ask;
						exchangeTable.lines[bid_idx]["upbitDiff"] = (upbit_per).toLocaleString();
						exchangeTable.lines[bid_idx]["upbitPer"] = (upbit_per / coinone_coin_ask * 100).toFixed(2).toString();
					}
				}
		 	};

		 	sock.onclose = function() {
		    console.log('close');
		 	};

		 	//Coinone Websocket Part
			let coinoneBTC = 1;
			const displayBtcStandard = document.getElementById("btc-standard"); 

		 	executeAllWebsockets();
		 	
		 	function executeAllWebsockets() {
				const coinsCoinone = { 	BTC: 1000, BCH: 500, ETH: 100, XRP: 1, LTC: 50 };
				for (let key in coinsCoinone) {
					coinoneWebsocket(key, coinsCoinone[key]);
				}				
		 	}

		 	function coinoneWebsocket(coin, unit) {
		 		let socket = io.connect(
										'https://push.coinone.co.kr/orderbook',
										{ transports:['websocket','polling'] }
									);
				
				socket.on('connect', function() {
					console.log(coin + " connected!");
					return socket.emit('subscribe', coin, unit)
				});

				socket.on('update', function(data) {
					if (data) {
						const ask_idx = coins[coin.toLowerCase()];
						const bid_idx = coins[coin.toLowerCase()] + 1;
						const askPrice = parseInt(JSON.parse(data.ASK)[0]['price']);
						const bidPrice = parseInt(JSON.parse(data.BID)[0]['price']);
						if (exchangeTable.lines[bid_idx]["bittrex"] && exchangeTable.lines[bid_idx]["bitstamp"] && exchangeTable.lines[bid_idx]["upbitKrw"]) {
							const bittrex_krw_bid = parseInt(exchangeTable.lines[bid_idx]["bittrexKrw"].replace(/,/g,""));
							const bitstamp_krw_bid = parseInt(exchangeTable.lines[bid_idx]["bitstampKrw"].replace(/,/g,""));
							const upbit_krw_bid = parseInt(exchangeTable.lines[bid_idx]["upbitKrw"].replace(/,/g,"")); 
							const upbit_bid = parseInt(exchangeTable.lines[bid_idx]["upbit"].replace(/,/g,"")); 
							exchangeTable.lines[bid_idx]["bittrexDiff"] = (bittrex_krw_bid - askPrice).toLocaleString();
							exchangeTable.lines[bid_idx]["upbitKrwDiff"] = (upbit_krw_bid - askPrice).toLocaleString();
							exchangeTable.lines[bid_idx]["upbitDiff"] = (upbit_bid - askPrice).toLocaleString();
							exchangeTable.lines[bid_idx]["bitstampDiff"] = (bitstamp_krw_bid - askPrice).toLocaleString();
						}
						exchangeTable.lines[ask_idx]["coinone"] = askPrice.toLocaleString();
						exchangeTable.lines[bid_idx]["coinone"] = bidPrice.toLocaleString();
					}
				});

				socket.on('error', function(err) {

				});
		 	}

		 	//Bitstamp Websocket Part
		 	const pusher = new Pusher('de504dc5763aeef9ff52');

		 	bitstampWebsocket();

		 	function bitstampWebsocket() {
		 		const coinsBitstamp = ['btcbtc', 'bchbtc', 'xrpbtc', 'ltcbtc', 'ethbtc'];
				const coinsBitstampUsd = ['xrpusd', 'ltcusd', 'bchusd'];
		 		for(i=0; i<coinsBitstamp.length; i++) {
		 			let coin = coinsBitstamp[i];
		 			let tradesChannel = pusher.subscribe('order_book_' + coin);
		 			tradesChannel.bind('data', function(data) {
						const coin_idx = coin.slice(0,3);
						const ask_idx = coins[coin_idx];
						const bid_idx = coins[coin_idx] + 1;
						exchangeTable.lines[ask_idx]["bitstamp"] = data.asks[0][0];
						exchangeTable.lines[bid_idx]["bitstamp"] = data.bids[0][0];

						if (exchangeTable.lines[1]["coinone"] && exchangeTable.lines[ask_idx]["coinone"]) {
							const coinone_btc_bid = parseInt(exchangeTable.lines[1]["coinone"].replace(/,/g,""));
							const coinone_coin_ask = parseInt(exchangeTable.lines[ask_idx]["coinone"].replace(/,/g,""));
							const bitstamp_krw_bid = parseInt(parseFloat(data.bids[0][0])*coinone_btc_bid);
							const bitstamp_krw_diff = bitstamp_krw_bid - coinone_coin_ask;
							exchangeTable.lines[ask_idx]["bitstampKrw"] = parseInt(parseFloat(data.asks[0][0])*coinone_btc_bid).toLocaleString();
							exchangeTable.lines[bid_idx]["bitstampKrw"] = bitstamp_krw_bid.toLocaleString();
							exchangeTable.lines[bid_idx]["bitstampDiff"] = (bitstamp_krw_diff).toLocaleString();
							exchangeTable.lines[bid_idx]["bitstampPer"] = (bitstamp_krw_diff / coinone_coin_ask * 100).toFixed(2).toString();
						}
					});
				 }
				 for(i=0; i<coinsBitstampUsd.length; i++) {
					 let coin = coinsBitstampUsd[i];
					 let tradesChannel = pusher.subscribe('order_book_' + coin);
					 tradesChannel.bind('data', function(data) {
						// updateDollarExchange(coin.slice(0,3), data.asks[0][0]);
					 });
				 }
		 	}

		 	function updatePrice(id, price) {
		 		document.getElementById(id).innerHTML = price.toLocaleString();
		 	}

		 	function updateData(coin, price) {
		 		data[coin.replace(/-/g,"_")] = price;
		 	}

		 	function updateDiff(exchange, coin, type, price) {
		 		let basePrice;
		 		let priceDiff;
		 		let pricePercentage;
		 		let selectedTd;
		 		
				if (coin == 'bcc') {
					basePrice = data['coinone_bch_ask'];
				} else {
					basePrice = data['coinone_'+coin+'_ask'];
				}
				
				if (basePrice != null && exchange =='upbit') {
					priceDiff = price - basePrice;
				} else if (exchange == 'upbit-btc') {
					priceDiff = price * upbitBTC - basePrice;
				} else {
					priceDiff = price * data['coinone_btc_ask'] - basePrice;
				}

				pricePercentage = (priceDiff / basePrice) * 100;
				diffTd = document.getElementById(exchange+'-'+coin+'-'+type+'-base-diff');
				percentTd = document.getElementById(exchange+'-'+coin+'-'+type+'-base-percent');
				if (diffTd && percentTd) {
					diffTd.innerHTML = parseInt(priceDiff).toLocaleString();
					percentTd.innerHTML = "(" + pricePercentage.toFixed(2).toString() + "%)";
					if (pricePercentage > 3 ) {
						diffTd.className = "plus_color4";
						percentTd.className = "plus_color4";
					} else if (pricePercentage > 2 ) {
						diffTd.className = "plus_color3";
						percentTd.className = "plus_color3";
					} else if (pricePercentage > 1 ) {
						diffTd.className = "plus_color2";
						percentTd.className = "plus_color2";
					} else if (pricePercentage > 0 ) {
						diffTd.className = "plus_color1";
						percentTd.className = "plus_color1";
					} else if (pricePercentage < -3 ) {
						diffTd.className = "minus_color4";
						percentTd.className = "minus_color4";
					} else if (pricePercentage < -2 ) {
						diffTd.className = "minus_color3";
						percentTd.className = "minus_color3";
					} else if (pricePercentage < -1 ) {
						diffTd.className = "minus_color2";
						percentTd.className = "minus_color2";
					} else {
						diffTd.className = "minus_color1";
						percentTd.className = "minus_color1";
					}
				}
				

				// if (pricePercentage > 2 && audio_flag) {
				// 	playAlarm('alarm.mp3');
				// }
		 	}
		 	
		 	// playAlarm("/settings.mp3");
			// fetch('https://api.bitflyer.jp/v1/ticker',{cors:true}).then((data)=>{
			// 	console.log(data);
			// }).catch((error)=>{
			// 	console.log(error);
			// })
			// $.ajax({
			// 	url: 'https://api.bithumb.com/public/ticker/all',
			// 	success: function(data) {
			// 		console.log(data);
			// 	},
			// 	error: function(xhr) {
			// 		console.log(xhr);
			// 	}
			// })
		 	function playAlarm(path) {
		 		audio_flag = false;
				const audio = new Audio(path);
				audio.addEventListener('ended', function(){
					console.log("audio ended!");
					setTimeout(function(){
						audio_flag = true;
						console.log("flag change!");
						console.log(audio_flag)
					}, 60000);
				})
		 		audio.play();
		 	}
		</script>	
	</body>
</html>